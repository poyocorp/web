<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>poyo pics</title>
  <link rel="stylesheet" href="main.css">
  <link rel="icon" type="image/png" href="../assets/happy-sprout.png" />
  <style>
    .photo-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .photo-item {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
    }

    .photo-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .photo-item img {
      width: 100%;
      height: 240px;
      object-fit: contain;
      display: block;
      background: #ffe96b;
    }

    .photo-caption {
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .photo-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
      color: #333;
    }

    .photo-username {
      font-size: 0.85rem;
      color: #666;
      margin: 0;
    }

    .view-hint {
      font-weight: 700;
      color: #333;
      opacity: 0.75;
    }

    .stuff-header {
      text-align: center;
      padding: 40px 20px 20px;
    }

    .stuff-title {
      font-size: 2.5rem;
      margin: 0;
      color: #333;
    }


    .empty {
      text-align: center;
      padding: 60px 20px;
      color: #666;
      font-size: 1.1rem;
    }

    /* Mobile responsive styles */
    @media (max-width: 768px) {
      .stuff-container {
        display: block !important;
        padding: 0 !important;
        margin: 10px auto !important;
      }

      .stuff-header {
        padding: 20px 10px 10px;
      }

      .stuff-header > div {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .stuff-title {
        font-size: 1.8rem;
        padding-right: 0 !important;
        flex: 1;
        text-align: center;
      }

      #toggleTitles {
        padding: 8px 16px !important;
        font-size: 1.2rem !important;
        right: 10px !important;
        position: absolute !important;
      }

      .photo-gallery {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
        padding: 12px;
      }

      .photo-item img {
        height: 180px;
      }

      .photo-caption {
        padding: 8px 12px;
      }

      .photo-title {
        font-size: 0.95rem;
      }

      .view-hint {
        font-size: 0.9rem;
      }

      /* Viewer modal adjustments for mobile */
      #viewer > div {
        width: 96% !important;
        padding: 0 8px;
      }

      #viewer > div > div:first-child {
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 8px;
      }

      #viewerClose, #toggleTitle {
        padding: 8px 16px !important;
        font-size: 0.9rem !important;
      }

      .stuff-title {
        font-size: 1.5rem !important;
      }

      #viewer img {
        max-height: 60vh !important;
        border-radius: 8px !important;
      }

      #viewer > div > div:last-child {
        grid-template-columns: 50px 1fr 50px !important;
        gap: 8px !important;
      }

      #prevBtn, #nextBtn {
        font-size: 1.5rem !important;
        padding: 8px !important;
      }

      #viewerDescWrap {
        margin-top: 8px !important;
      }

      #viewerDescWrap > div {
        padding: 12px !important;
      }

      #viewerTitle {
        font-size: 1.3rem !important;
      }

      #viewerDesc {
        font-size: 0.95rem !important;
      }
    }

    @media (max-width: 480px) {
      .stuff-title {
        font-size: 1.5rem;
      }

      #toggleTitles {
        padding: 6px 12px !important;
        font-size: 1rem !important;
      }

      .photo-gallery {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 8px;
        padding: 8px;
      }

      .photo-item img {
        height: 140px;
      }

      .photo-caption {
        padding: 6px 10px;
      }

      .photo-title {
        font-size: 0.85rem;
      }

      .view-hint {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body class="stuff-body">
  <header class="stuff-header">
    <div style="position:relative">
      <h1 class="stuff-title">poyo pics</h1>
      <button id="toggleTitles" class="btn" style="position:absolute;top:0;right:20px;background:#4caf50;color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-weight:600;font-size:1.4rem;transition:background 0.3s,transform 0.2s,opacity 0.2s">üëÅÔ∏è</button>
    </div>
  </header>

  <div class="stuff-container">
    <a class="back" href="../index.html">‚Üê Home</a>

    <div id="gallery" class="photo-gallery" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none">
      No photos yet ‚Äî check back later!
    </div>
  </div>

  <!-- Viewer Modal -->
  <div id="viewer" style="display:none;position:fixed;inset:0;z-index:3000;background:rgba(0,0,0,0.25)">
    <div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:1000px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:12px">
        <button id="viewerClose" class="btn" style="background:#f44336;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600">Close</button>
        <div class="stuff-title" style="font-size:2rem;flex:1;text-align:center"></div>
        <button id="toggleTitle" class="btn" style="background:#ff5722;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600;font-size:1rem;transition:background 0.3s">Hide Info</button>
      </div>
      <div style="display:grid;grid-template-columns:80px 1fr 80px;gap:12px;align-items:center">
        <button id="prevBtn" class="tab" style="font-size:2rem;background:transparent">&lt;</button>
        <div style="max-height:85vh;overflow-y:auto">
          <img id="viewerImg" src="" alt="" style="width:100%;max-height:70vh;object-fit:contain;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);background:#ffe96b">
          <div id="viewerDescWrap" style="margin-top:12px;background:rgba(255,255,255,0.9);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
            <div style="padding:16px 18px">
              <h2 id="viewerTitle" style="margin:0 0 6px 0;color:#333"></h2>
              <p id="viewerDesc" style="margin:0;color:#555;font-size:1.1rem"></p>
              <div id="viewerUserWrap" style="margin-top:12px;color:#666;font-size:0.95rem"></div>
            </div>
          </div>
        </div>
        <button id="nextBtn" class="tab" style="font-size:2rem;background:transparent">&gt;</button>
      </div>
    </div>
  </div>

  <script>
    async function loadPhotos() {
      try {
        const res = await fetch('../data/photography.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('Failed to load');
        
        const photos = await res.json();
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = '';

        if (!photos || photos.length === 0) {
          document.getElementById('empty').style.display = 'block';
          return;
        }

        photos.forEach(photo => {
          const item = document.createElement('div');
          item.className = 'photo-item';
          
          // Create URL-friendly slug from title
          const slug = photo.title.toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/(^-|-$)/g, '');

          const imgSrc = resolveImg(photo.image);
          console.log('Loading image:', imgSrc); // Debug log

          item.innerHTML = `
            <img src="${escapeAttr(imgSrc)}" alt="${escapeAttr(photo.title)}" onerror="console.error('Failed to load:', this.src); this.style.background='#ffcccc';">
            <div class="photo-caption">
              <h3 class="photo-title">${escapeHtml(photo.title)}</h3>
              <span class="view-hint">View ‚Üí</span>
            </div>
          `;

          item.addEventListener('click', () => {
            openViewer(indexFromSlug(photos, slug));
          });

          gallery.appendChild(item);
        });

        // Setup viewer navigation
        setupViewer(photos);
      } catch (err) {
        console.error(err);
        document.getElementById('empty').textContent = 'Unable to load photos.';
        document.getElementById('empty').style.display = 'block';
      }
    }

    function escapeHtml(s) {
      if (!s) return '';
      return String(s).replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;');
    }

    function escapeAttr(s) {
      if (!s) return '';
      return String(s).replace(/"/g, '%22')
                      .replace(/'/g, '%27');
    }

    function resolveImg(u){
      const url = String(u||'').trim();
      if (!url) return '';
      if (url.startsWith('http://') || url.startsWith('https://')) return url;
      // photography.html is under /web/, JSON paths like 'assets/uploads/...' need '../'
      if (url.startsWith('../')) return url;
      if (url.startsWith('/')) return url;
      return '../' + url.replace(/^\/*/, '');
    }

    loadPhotos();

    // --- Toggle titles on main gallery ---
    document.addEventListener('DOMContentLoaded', function(){
      const toggleBtn = document.getElementById('toggleTitles');
      if(toggleBtn){
        // Hover effect
        toggleBtn.addEventListener('mouseenter', function(){
          this.style.transform = 'scale(1.1)';
          this.style.opacity = '0.9';
        });
        toggleBtn.addEventListener('mouseleave', function(){
          this.style.transform = 'scale(1)';
          this.style.opacity = '1';
        });
        
        toggleBtn.addEventListener('click', function(){
          const captions = document.querySelectorAll('.photo-caption');
          const isHidden = captions[0] && captions[0].style.display === 'none';
          captions.forEach(function(cap){ cap.style.display = isHidden ? 'flex' : 'none'; });
          // Change color: green when showing, red when hidden
          toggleBtn.style.background = isHidden ? '#4caf50' : '#f44336';
        });
      }
    });

    // --- Viewer logic ---
    let viewerPhotos = [];
    let viewerIndex = 0;

    function indexFromSlug(arr, slug){
      for(let i=0;i<arr.length;i++){
        const s = String(arr[i].title||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
        if(s === slug) return i;
      }
      return 0;
    }

    function setupViewer(photos){
      viewerPhotos = photos || [];
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const closeBtn = document.getElementById('viewerClose');
      const toggleBtn = document.getElementById('toggleTitle');
      if(prevBtn) prevBtn.addEventListener('click', ()=>{ showViewerAt(viewerIndex-1); });
      if(nextBtn) nextBtn.addEventListener('click', ()=>{ showViewerAt(viewerIndex+1); });
      if(closeBtn) closeBtn.addEventListener('click', closeViewer);
      if(toggleBtn) toggleBtn.addEventListener('click', ()=>{
        const wrap = document.getElementById('viewerDescWrap');
        const isHidden = wrap && wrap.style.display === 'none';
        if(wrap) wrap.style.display = isHidden ? 'block' : 'none';
        // Update button text and color based on state
        toggleBtn.textContent = isHidden ? 'Hide Info' : 'Show Info';
        toggleBtn.style.background = isHidden ? '#ff5722' : '#4caf50';
      });
      const overlay = document.getElementById('viewer');
      if(overlay) overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeViewer(); });
    }

    function openViewer(index){
      viewerIndex = Math.max(0, Math.min(viewerPhotos.length-1, index||0));
      showViewerAt(viewerIndex);
      const el = document.getElementById('viewer');
      const wrap = document.getElementById('viewerDescWrap');
      const toggleBtn = document.getElementById('toggleTitle');
      if(el) el.style.display = 'block';
      if(wrap) wrap.style.display = 'block';
      // Reset toggle button to default state (Hide Info, orange)
      if(toggleBtn) {
        toggleBtn.textContent = 'Hide Info';
        toggleBtn.style.background = '#ff5722';
      }
    }

    function closeViewer(){
      const el = document.getElementById('viewer');
      if(el) el.style.display = 'none';
    }

    function showViewerAt(i){
      if(viewerPhotos.length === 0) return;
      if(i < 0) i = viewerPhotos.length-1;
      if(i >= viewerPhotos.length) i = 0;
      viewerIndex = i;
      const p = viewerPhotos[i];
      const img = document.getElementById('viewerImg');
      const ttl = document.getElementById('viewerTitle');
      const dsc = document.getElementById('viewerDesc');
      const uw = document.getElementById('viewerUserWrap');
      if(img) img.src = resolveImg(p.image||'');
      if(ttl) ttl.textContent = p.title||'';
      if(dsc) dsc.textContent = p.description||'';
      if(uw) uw.innerHTML = p.username ? `<strong>By:</strong> ${escapeHtml(p.username)}` : '';
    }
  </script>
</body>
</html>
