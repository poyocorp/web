<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SproutTube</title>
  <link rel="stylesheet" href="main.css">
  <link rel="icon" type="image/png" href="assets/happy-sprout.png" />
</head>
<body class="sprouttube-body">
  <header class="sprouttube-header">
    <h1 class="sprouttube-title">SproutTube</h1>
  </header>

  <div class="sprouttube-container">
    <a class="back" href="../index.html">← Home</a>

    <div id="grid" class="sprouttube-grid" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none">
      No videos yet — check back later or use the Admin to add videos.
    </div>
  </div>

  <script>
    async function load(){
      try{
        const res = await fetch('../data/sprouttube.json', { cache:'no-store' });
        if(!res.ok) throw new Error('Failed to load');
        
        const items = await res.json();
        const grid = document.getElementById('grid');
        grid.innerHTML = '';

        if(!items || items.length === 0){
          document.getElementById('empty').style.display='block';
          return;
        }

        items.forEach(it => {
          const card = document.createElement('article');
          card.className = 'sprouttube-card';

          const videoHtml = it.videoId
            ? `<div class="video-container"><iframe src="https://www.youtube.com/embed/${escapeAttr(it.videoId)}" title="${escapeAttr(it.title)}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`
            : '';

          card.innerHTML = `
            ${videoHtml}
            <div class="sprouttube-content">
              <h3>${escapeHtml(it.title)}</h3>
              <p class="desc">${escapeHtml(it.description)}</p>
            </div>

            <div class="meta">
              <div class="username">${escapeHtml(it.username)}</div>
              <a class="visit" href="${escapeAttr(it.url)}" target="_blank" rel="noopener noreferrer">Watch on YouTube ↗</a>
            </div>
          `;

          grid.appendChild(card);
        });
      }catch(err){
        document.getElementById('empty').textContent = 'Unable to load videos.';
        document.getElementById('empty').style.display = 'block';
      }
    }

    function escapeHtml(s){
      if(!s) return '';
      return s.replace(/&/g,'&amp;')
              .replace(/</g,'&lt;')
              .replace(/>/g,'&gt;');
    }

    function escapeAttr(s){
      return String(s)
        .replace(/"/g,'%22')
        .replace(/'/g,'%27');
    }

    load();
  </script>
</body>
</html>