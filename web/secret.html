<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stretch Sprout ‚Äî Secret</title>
    <link rel="stylesheet" href="main.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        .container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 600px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
            user-select: none;
            overflow: hidden;
        }

        .container:active {
            cursor: grabbing;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 195, 122, 0.9);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 14px;
            transition: background 0.3s;
            z-index: 10;
        }

        .back-link:hover {
            background: rgba(0, 195, 122, 1);
        }

        .title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        #stretchCanvas {
            display: block;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
        }

        .info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            color: white;
            text-align: center;
            font-size: 14px;
            opacity: 0.8;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            z-index: 5;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Back</a>
    <div class="title">Stretch Sprout!</div>

    <div class="container" id="stretchContainer">
        <canvas id="stretchCanvas"></canvas>
        <div class="info">
            üëâ Drag to stretch! üëà
        </div>
    </div>

    <script>
        const container = document.getElementById('stretchContainer');
        const canvas = document.getElementById('stretchCanvas');
        const ctx = canvas.getContext('2d');

        let isStretching = false;
        let startX = 0;
        let startY = 0;
        let stretchX = 0;
        let stretchY = 0;
        let targetStretchX = 0;
        let targetStretchY = 0;
        let grabbedLimb = null;

        const maxStretch = 100;
        const spriteScale = 2;

        // Load all body parts - store actual dimensions from image
        const parts = {
            body: { img: null, baseW: 0, baseH: 0, deform: true, offset: {x: 0, y: 30} },
            face: { img: null, baseW: 0, baseH: 0, deform: false, offset: {x: 0, y: -60} },
            armL: { img: null, baseW: 0, baseH: 0, deform: true, offset: {x: -70, y: 0} },
            armR: { img: null, baseW: 0, baseH: 0, deform: true, offset: {x: 70, y: 0} },
            feetL: { img: null, baseW: 0, baseH: 0, deform: true, offset: {x: -40, y: 80} },
            feetR: { img: null, baseW: 0, baseH: 0, deform: true, offset: {x: 40, y: 80} }
        };

        let partsLoaded = 0;
        const partsList = [
            { key: 'body', src: '../assets/LayeredSproutPoyo/Sprout.png' },
            { key: 'face', src: '../assets/LayeredSproutPoyo/Face.png' },
            { key: 'armL', src: '../assets/LayeredSproutPoyo/arms/L_Arm.png' },
            { key: 'armR', src: '../assets/LayeredSproutPoyo/arms/R_Arm.png' },
            { key: 'feetL', src: '../assets/LayeredSproutPoyo/feet/L_Feet.png' },
            { key: 'feetR', src: '../assets/LayeredSproutPoyo/feet/R_Feet.png' }
        ];

        partsList.forEach(part => {
            const img = new Image();
            img.src = part.src;
            img.onload = () => {
                parts[part.key].img = img;
                parts[part.key].baseW = img.naturalWidth;
                parts[part.key].baseH = img.naturalHeight;
                console.log('Loaded:', part.key, 'w=', img.naturalWidth, 'h=', img.naturalHeight);
                partsLoaded++;
                if (partsLoaded === partsList.length) {
                    canvas.width = 800;
                    canvas.height = 600;
                    animate();
                }
            };
            img.onerror = () => {
                console.error('Failed to load:', part.src);
                partsLoaded++;
                if (partsLoaded === partsList.length) {
                    canvas.width = 800;
                    canvas.height = 600;
                    animate();
                }
            };
        });

 function detectGrabbedLimb(x, y) {
    const rect = canvas.getBoundingClientRect();
    const canvasX = x - rect.left;
    const canvasY = y - rect.top;

    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;

    const limbs = ['face', 'armL', 'armR', 'body', 'feetL', 'feetR'];

    for (let limb of limbs) {
        const part = parts[limb];
        if (!part.img) continue;

        // scale image size only, not offset
        const drawW = part.baseW * spriteScale;
        const drawH = part.baseH * spriteScale;

        // FIXED: offset is not scaled
        const partX = centerX + part.offset.x;
        const partY = centerY + part.offset.y;

        const left = partX - drawW / 2;
        const top = partY - drawH / 2;

        if (canvasX >= left && canvasX <= left + drawW &&
            canvasY >= top && canvasY <= top + drawH) {
            return limb;
        }
    }
    return null;
}

        function startStretch(e) {
            isStretching = true;
            if (e.touches) {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            } else {
                startX = e.clientX;
                startY = e.clientY;
            }
            grabbedLimb = detectGrabbedLimb(startX, startY);
        }

        function stretch(e) {
            if (!isStretching) return;
            e.preventDefault();

            let currentX, currentY;
            if (e.touches) {
                currentX = e.touches[0].clientX;
                currentY = e.touches[0].clientY;
            } else {
                currentX = e.clientX;
                currentY = e.clientY;
            }

            const deltaX = (currentX - startX);
            const deltaY = (currentY - startY);

            targetStretchX = Math.max(-maxStretch, Math.min(maxStretch, deltaX * 0.3));
            targetStretchY = Math.max(-maxStretch, Math.min(maxStretch, deltaY * 0.3));
        }

        function stopStretch() {
            isStretching = false;
            targetStretchX = 0;
            targetStretchY = 0;
            grabbedLimb = null;
        }

        container.addEventListener('mousedown', startStretch);
        document.addEventListener('mousemove', stretch);
        document.addEventListener('mouseup', stopStretch);

        container.addEventListener('touchstart', startStretch);
        document.addEventListener('touchmove', stretch, { passive: false });
        document.addEventListener('touchend', stopStretch);

        function animate() {
            // Smooth interpolation toward target
            stretchX += (targetStretchX - stretchX) * 0.15;
            stretchY += (targetStretchY - stretchY) * 0.15;

            // Clear and draw all parts
            ctx.fillStyle = 'transparent';
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Draw in z-order: feet, body, arms, then face (rigid, always on top)
            drawPart('feetL', centerX, centerY);
            drawPart('feetR', centerX, centerY);
            drawPart('body', centerX, centerY);
            drawPart('armL', centerX, centerY);
            drawPart('armR', centerX, centerY);
            drawPart('face', centerX, centerY);

            requestAnimationFrame(animate);
        }

        function drawPart(partKey, centerX, centerY) {
    const part = parts[partKey];
    if (!part.img || !part.baseW || !part.baseH) return;

    let scaleX = spriteScale;
    let scaleY = spriteScale;

    // stretching still only affects limbs
    if (part.deform && grabbedLimb === partKey) {
        scaleX = spriteScale * (1 + (stretchX / maxStretch) * 0.4);
        scaleY = spriteScale * (1 + (stretchY / maxStretch) * 0.4);

        // clamp deformation
        scaleX = Math.max(spriteScale * 0.8, Math.min(spriteScale * 1.2, scaleX));
        scaleY = Math.max(spriteScale * 0.8, Math.min(spriteScale * 1.2, scaleY));
    }

    const drawW = part.baseW * scaleX;
    const drawH = part.baseH * scaleY;

    // FIXED: offsets are NOT scaled (this stops misalignment!)
    const partX = centerX + part.offset.x;
    const partY = centerY + part.offset.y;

    ctx.drawImage(part.img, partX - drawW / 2, partY - drawH / 2, drawW, drawH);
}
    </script>
</body>
</html>
